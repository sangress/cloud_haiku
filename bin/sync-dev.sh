#!/bin/sh

ORANGE='\033[0;33m'
GREEN='\033[0;32m'
NO_COLOR='\033[0m'
BOLD=$(tput bold)
NORMAL=$(tput sgr0)

git config user.name $actor

timestamp() {
  date +"%s"
}

PR_BRANCH_NAME=dev_main_$(timestamp)

cd $1

echo "${ORANGE}Dir: ${GREEN}$(pwd)\n"

echo "${ORANGE}Checkout -> ${GREEN}main.${NO_COLOR}"
git checkout main
echo "${ORANGE}Pull -> ${BOLD}${GREEN}main.${NO_COLOR}"
git pull
echo "${ORANGE}Checkout -> ${GREEN}dev.${NO_COLOR}"
git checkout dev
echo "${ORANGE}Pull -> ${GREEN}dev.${NO_COLOR}"
git pull
echo "${ORANGE}Checkout from dev -> ${GREEN}${PR_BRANCH_NAME}"
git checkout -b ${PR_BRANCH_NAME}
echo "${ORANGE}Merge ${GREEN}main${ORANGE} -> ${GREEN}${PR_BRANCH_NAME}${NO_COLOR}"
git merge main --commit --no-edit --allow-unrelated-histories
git checkout --theirs .
git add .
git commit -m "merge commit"

echo "${ORANGE}Pushing -> ${GREEN}${PR_BRANCH_NAME}${NO_COLOR}"
git push --set-upstream origin ${PR_BRANCH_NAME}

echo "${GREEN}Creating PR.${NO_COLOR}"
gh auth login
gh pr create -B dev -a @me --title "Merge main with dev" --body "Autogenerated pull request to sync dev with main."


echo "\n${GREEN}Done.${NO_COLOR}"
